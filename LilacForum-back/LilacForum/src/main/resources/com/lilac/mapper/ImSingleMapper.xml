<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lilac.mapper.ImSingleMapper">

    <!-- 插入一条消息记录 -->
    <insert id="insertSelective" parameterType="com.lilac.pojo.ImSingle">
        INSERT INTO im_single (content, from_user, from_avatar, time, type, to_user, to_avatar, is_read)
        VALUES (#{content}, #{fromUser}, #{fromAvatar}, #{time}, #{type}, #{toUser}, #{toAvatar}, #{isRead})
    </insert>

    <!-- 根据用户名查找消息记录 -->
    <select id="findByUsername" parameterType="map" resultType="com.lilac.pojo.ImSingle">
        SELECT * FROM imSingle
        WHERE (from_user = #{fromUser} AND to_user = #{toUser})
           OR (from_user = #{toUser} AND to_user = #{fromUser})
        ORDER BY time ASC
    </select>

    <!-- 更新消息为已读 -->
    <update id="updateByPrimaryKey" parameterType="com.lilac.pojo.ImSingle">
        UPDATE im_single
        SET is_read = 1
        WHERE id = #{id} AND is_read = 0
    </update>

    <!-- 查找未读消息 -->
    <select id="findByToUsername" parameterType="String" resultType="com.lilac.pojo.ImSingle">
        SELECT * FROM imSingle
        WHERE to_user = #{toUser} AND is_read = 0
    </select>

</mapper>
